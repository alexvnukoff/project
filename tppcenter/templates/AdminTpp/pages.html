{% extends "AdminTpp/baseAdmin.html" %}
{% load staticfiles %}

{% block title %}Adveretisement settnings{% endblock %}

{% block style %}
    {{ block.super }}
    <!-- DATA TABLES -->
    <link href="{% static "admin-tpp/css/datatables/dataTables.bootstrap.css" %}" rel="stylesheet" type="text/css"
          xmlns="http://www.w3.org/1999/html"/>
{% endblock %}


{% block content %}
    <div class="row">
                        <div class="col-xs-12">
                            <div class="box">
                                <div class="box-header">
                                    <h3 class="box-title">Pages B2B</h3>
                                </div><!-- /.box-header -->
                                <div class="box-body table-responsive">
                                    <table id="pages-b2b" class="pages table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>On top</th>
                                                <th>Type</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="10" class="dataTables_empty">Loading data from server</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th>Name</th>
                                                <th>On top</th>
                                                <th>Type</th>
                                                <th>Action</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div><!-- /.box-body -->

                            </div><!-- /.box -->
                        </div>
                    </div>

    <div class="row">
                        <div class="col-xs-12">
                            <div class="box">
                                <div class="box-header">
                                    <h3 class="box-title">Pages B2C</h3>
                                </div><!-- /.box-header -->
                                <div class="box-body table-responsive">
                                    <table id="pages-b2c" class="pages table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>On top</th>
                                                <th>Type</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="10" class="dataTables_empty">Loading data from server</td>
                                            </tr>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th>Name</th>
                                                <th>On top</th>
                                                <th>Type</th>
                                                <th>Action</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div><!-- /.box-body -->

                            </div><!-- /.box -->
                        </div>
                    </div>

    <div class="row">
                        <div class="col-xs-12">
                            <div class="box">
                                <div class="box-header">
                                    <h3 class="box-title">Add new page</h3>
                                </div><!-- /.box-header -->
                                <div class="box-body table-responsive">

                                {% if form.errors %}
                                    {% for type, eror in result.errors.items %}
                                        <p class="text-red">{{ eror }}</p>
                                    {% endfor %}
                                {% endif %}

                                {% with form.fields.DETAIL_TEXT.initial as text %}
                                {% with form.fields.NAME.initial as title %}

                                <form method="POST">
                                    {% csrf_token %}
                                    <div class="form-group">
                                         {% if form.errors.NAME  %}
                                            <label class="control-label" for="inputError">
                                                <i class="fa fa-times-circle-o"></i>
                                                {{ form.errors.NAME }}
                                            </label>
                                        {% endif %}
                                        <input name="NAME" type="text" class="form-control" value="{{ title }}" placeholder="Title">
                                    </div>
                                    <div class="form-group">

                                        <label>Type</label>
                                        {% if form.errors.TYPE  %}
                                            <label class="control-label" for="inputError">
                                                <i class="fa fa-times-circle-o"></i>
                                                {{ form.errors.TYPE }}
                                            </label>
                                        {% endif %}
                                        <select name="type" class="form-control">
                                            {% for type, name in types %}
                                                <option {% if type == selectedType %}selected="selected" {% endif %} value="{{ type }}">
                                                    {{ name }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        {% if form.errors.DETAIL_TEXT  %}
                                            <label class="control-label" for="inputError">
                                                <i class="fa fa-times-circle-o"></i>
                                                {{ form.errors.DETAIL_TEXT }}
                                            </label>
                                        {% endif %}
                                        <textarea class="tiny" name="DETAIL_TEXT" >{{ text }}</textarea>
                                    </div>
                                    <div class="form-group">
                                        <input type="submit" class="btn btn-success" value="save" />
                                    </div>

                                </form>
                                {% endwith %}
                                {% endwith %}
                                </div><!-- /.box-body -->

                            </div><!-- /.box -->
                        </div>
                    </div>

        <!-- Bootstrap -->

        <!-- DATA TABES SCRIPT -->

        <!-- AdminLTE App -->


        <!-- page script -->

{% endblock %}

{% block bottomScript %}
    {{ block.super }}
    <script src="{% static "admin-tpp/js/bootstrap.min.js" %}" type="text/javascript"></script>
    <script src="//cdn.datatables.net/1.10.3/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="{% static "admin-tpp/js/plugins/datatables/dataTables.bootstrap.js" %}" type="text/javascript"></script>
    <script src="{% static "admin-tpp/js/AdminLTE/app.js" %}" type="text/javascript"></script>
    <script src="//tinymce.cachefly.net/4/tinymce.min.js"></script>
    <script src="//tinymce.cachefly.net/4/jquery.tinymce.min.js"></script>

    <script type="text/javascript">
        $(function() {

            $('.tiny').tinymce({
                        mode:"textareas",
                        selector: '.tiny',
                        plugins : "image wordcount media textcolor hr autolink link lists print preview code",
                        //language_url : '{% static "tppcenter/js/tinymce/langs/ru.js" %}'
                    });

            $(document).on('click', '.savePage', function() {
               var ser = $(this).parents('tr').find('input').serialize();

               var button = $(this);
               $(this).addClass("disabled");

               $.post("/admin-tpp/pages/edit/" + $(this).data('pk') + "/", ser, function() {
                    button.removeClass('disabled');
               });
            });

           $('#pages-b2b').on( 'draw.dt', function () {
                    $("input[type='checkbox'], input[type='radio']").iCheck({
                        checkboxClass: 'icheckbox_minimal',
                        radioClass: 'iradio_minimal'
                    });
            } ).dataTable( {
                "ajax": "{% url "AdminTpp:pages" %}?type=b2b",
                "processing": true,
                "serverSide": true,
                "searching": false,
                "ordering":  false,
                "columnDefs": [
                    {
                        "targets": [ 0 ],
                        "data": 0,
                        "render": function ( data, type, full ) {

                             return '<div class="form-group">' +
                                        '<input value="' + data + '" type="text" class="form-control" name="NAME"/>' +
                                    '</div>';
                        }
                    },
                    {
                        "targets": [ 1 ],
                        "data": 1,
                        "render": function ( data, type, full ) {

                            var checked = "";

                            if (data == "1")
                                checked = 'checked="checked"';

                            return '<div class="checkbox"><label><input name="onTop" ' + checked + ' type="checkbox"/></label></div>';
                        }
                    },
                    {
                        "targets": [ 3 ],
                        "data": 3,
                        "render": function ( data, type, full ) {

                            return '<button data-pk="' + data + '" class="savePage btn btn-success">Save</button> ' +
                                    '<a href="/admin-tpp/pages/edit/' + data + '/">' +
                                    '<button class="btn btn-info">Edit</button>' +
                                    '</a> ' +
                                    '<a href="/admin-tpp/pages/delete/' + data + '/">' +
                                    '<button class="btn btn-danger">Remove</button>' +
                                    '</a>';

                        }
                    }
               ]
            });



            $('#pages-b2c').on( 'draw.dt', function () {
                    $("input[type='checkbox'], input[type='radio']").iCheck({
                        checkboxClass: 'icheckbox_minimal',
                        radioClass: 'iradio_minimal'
                    });
            } ).dataTable( {
                "ajax": "{% url "AdminTpp:pages" %}?type=b2c",
                "processing": true,
                "serverSide": true,
                "searching": false,
                "ordering":  false,
                "columnDefs": [
                    {
                        "targets": [ 0 ],
                        "data": 0,
                        "render": function ( data, type, full ) {

                             return '<div class="form-group">' +
                                        '<input value="' + data + '" type="text" class="form-control" name="NAME"/>' +
                                    '</div>';
                        }
                    },
                    {
                        "targets": [ 1 ],
                        "data": 1,
                        "render": function ( data, type, full ) {

                            var checked = "";

                            if (data == "1")
                                checked = 'checked="checked"';

                            return '<div class="checkbox"><label><input name="onTop" ' + checked + ' type="checkbox"/></label></div>';
                        }
                    },
                    {
                        "targets": [ 3 ],
                        "data": 3,
                        "render": function ( data, type, full ) {

                            return '<button data-pk="' + data + '" class="savePage btn btn-success">Save</button> ' +
                                    '<a href="/admin-tpp/pages/edit/' + data + '/">' +
                                    '<button class="btn btn-info">Edit</button>' +
                                    '</a> ' +
                                    '<a href="/admin-tpp/pages/delete/' + data + '/">' +
                                    '<button class="btn btn-danger">Remove</button>' +
                                    '</a>';

                        }
                    }
               ]
            });


        });
    </script>
{% endblock %}