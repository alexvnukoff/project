{% extends 'usersites_templates/ibonds/index.html' %}

{% load i18n %}
{% load CustomFilters %}
{% load staticfiles %}
{% load humanize %}

{% block after_css %}
  <link rel="stylesheet" href="{% static 'usersites/css/messages.css' %}">
{% endblock %}

{% block title %}{{ object.name }}{% endblock %}

{% block content %}
  {{ block.super }}
  <section class="content__info grid-layout">
    <div class="container">
      <div class="row">
        <div class="col-md-4 col-sm-4">
          <div class="row">
            <div class="col-md-12 col-sm-12 heading">
              <h4>{% trans 'Your chats list' %}</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 col-sm-12 chats-list">
              <ul class="nav nav-tabs">
                <li class="active"><a href="#organization" aria-controls="organization" role="tab" data-toggle="tab">{% trans 'Organization' %}</a></li>
                <li><a href="#private" aria-controls="private" role="tab" data-toggle="tab">{% trans 'Private' %}</a></li>
                <li><a href="#addnew" aria-controls="addnew" role="tab" data-toggle="tab">{% trans 'New chat' %}</a></li>
              </ul>
              <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="organization">
                  <ul class="list-group">
                    {% for chat in organization_chats %}
                      {% get_chat_other_side chat as other_side %}
                      <li class="list-item {% if chat.created_by != request.user %}incoming-chat{% else %}outgoing-chat{% endif %}">
                        <span class="thumb">
                          {% if other_side.profile.avatar %}
                            <img src="{{ other_side.profile.avatar.th }}" />
                          {% else %}
                            <img style="width: 24px;height: 24px;" 
                              src="{% static 'b24online/img/profile.jpg' %}" />
                          {% endif %}
                        </span>
                        <a data-url="" 
                          data-chat-id="{{ chat.pk }}" href="#">{% if other_side.profile.full_name %}{{ other_side.profile.full_name }}{% else %}{{ other_side.email }}{% endif %}</a>
                      </li>
                    {% empty %}
                      <h4 class="list-group-item" style="border: none;">{% trans 'There are no records yet' %}</h4>
                    {% endfor %}
                  </ul>
                </div>
                <div role="tabpanel" class="tab-pane fade" id="private">
                  <ul class="custom-ms">
                    <li style="display: none"><a href="#placeholder"></a> </li>
                    {% for chat in user_chats %}
                      {% get_chat_other_side chat as other_side %}
                      <li class="data-item {% if chat.created_by != request.user %}incoming-chat{% else %}outgoing-chat{% endif %}">
                        <span class="thumb">
                          {% if other_side.profile.avatar %}
                            <img src="{{ other_side.profile.avatar.th }}" />
                          {% else %}
                            <img style="width: 24px;height: 24px;" 
                              src="{% static 'b24online/img/profile.jpg' %}" />
                          {% endif %}
                        </span>
                        <a data-url="{% url 'messages:chat_messages' chat.pk  %}" 
                          data-chat-id="{{ chat.pk }}" href="#">{% if other_side.profile.full_name %}{{ other_side.profile.full_name }}{% else %}{{ other_side.email }}{% endif %}</a>
                      </li>
                    {% empty %}
                      <h4 class="list-group-item" style="border: none;">{% trans 'There are no records yet' %}</h4>
                    {% endfor %}
                  </ul>
                </div>
                {% if new_message_form %}
                <div role="tabpanel" class="tab-pane fade" id="addnew">
                  <div class="content">
                  <div class="row">
                  <div class="col-md-12 col-sm-12">
                  <form id="new_message_form" action="{% url 'messages:add_to_chats' %}" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group">
                      <label for="subject">{{ new_message_form.subject.label }}</label>
                      {{ new_message_form.subject }}
                      <span id="subject_errors" class="error help-inline error-hidden"></span>
                    </div>
                    <div class="form-group">
                      <label for="content required">{{ new_message_form.content.label }}</label>
                      {{ new_message_form.content }}
                      <span id="content_errors" class="error help-inline error-hidden"></span>
                    </div>
                    <div class="form-group">
                      <label for="attachment">{{ new_message_form.attachment.label }}</label>
                      {{ new_message_form.attachment }}
                      <span id="attachment_errors" class="error help-inline error-hidden"></span>
                    </div>
                    <button id="save_new_message" class="btn btn-default">{% trans 'Send message' %}</button>
                  </form>
                  </div>
                  </div>
                  </div>
                </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-7 col-sm-7">
          <div class="row">
            <div class="col-md-12 col-sm-12 col-md-offset-1 col-sm-offset-1 heading">
              <h4>{% trans 'Chat content' %}</h4>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 col-sm-12 chats-list">
            
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endblock %}

{% block js %}
  <script type="text/javascript"  src="http://malsup.github.com/jquery.form.js"></script>
  <script src="{% static 'usersites/js/messages.js' %}"></script>
{% endblock %}
