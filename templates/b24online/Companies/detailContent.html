{% extends 'b24online/main_page.html' %}
{% load static %}
{% load i18n %}
{% load CustomFilters %}
{% load inclusionTags %}
{% load compress %}
{% block styles %}
  {{ block.super }}
  {% compress css %}
    <link type="text/css" rel="stylesheet" href="{% static 'b24online/css/news.css' %}" />
    <link type="text/css" rel="stylesheet" href="{% static 'b24online/css/company.css' %}" />
    <link type="text/css" rel="stylesheet" href="{% static 'b24online/css/tpp.reset.css' %}" />
    <link type="text/css" rel="stylesheet" href="{% static 'b24online/css/gmapCompany.css' %}" />
  {% endcompress %}
{% endblock %}
{% block js %}
  {{ block.super }}

  <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
  <script src="{% static 'b24online/js/gmapSearchMarker.js' %}"></script>
  <script src="{% static 'b24online/js/jquery.uploadify.min.js' %}"></script>

  <!-- Google maps -->
  <script type="text/javascript">
    var marker;
    $(document).ready(function($) {
      var tabs = $( '#tpp-details-tab' )
      tabs.tabs();
      var href = tabs.find('a[href="#cpn-tabs-contacts"]');
      (href).on('click',function(){
        {% if item.location %}
          {% with item.location|split:"," as LatLng %}
            marker = new google.maps.Marker({
              position: new google.maps.LatLng({{ LatLng.0 }}, {{ LatLng.1 }})
            });
          {% endwith %}
        {% endif %}
       initialize(false);
      });
    });
  </script>
    <!-- /Google maps -->

  <script type="text/javascript">
   $(document).ready(function($) {

      var dialog, form,
      emailRegex = /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,
      realname = $("#fback-name"),
      phone = $("#fback-phone"),
      email = $("#fback-email"),
      message = $("#fback-message"),
      allFields = $([]).add(realname).add(phone).add(email).add(message),
      tips = $("#validateTips");

      function updateTips(t) {
        tips.text(t);
      };

      function checkLength(o, n, min, max) {
        if (o.val().length > max || o.val().length < min) {
          o.addClass("ui-state-error");
          updateTips("{% trans 'This field is required.' %}");
          return false;
        } else {
          return true;
        }
      };

    function checkRegexp(o, regexp, n) {
      if (!( regexp.test(o.val() ))) {
        o.addClass("ui-state-error");
        updateTips(n);
        return false;
      } else {
        return true;
      }
    };

    function SendFeedbackForm() {
      var valid = true;
      allFields.removeClass("ui-state-error");

      valid = valid && checkLength(realname, "realname", 2, 40);
//      valid = valid && checkLength(phone, "phone", 2, 40);
      valid = valid && checkLength(email, "email", 6, 80 );
      valid = valid && checkRegexp(email, emailRegex, '{% trans 'Enter a valid email address.' %}' );
      valid = valid && checkLength(message, "message", 2, 1000);

      if(valid) {
        formdata = form.serialize();
         $.ajax({
          type: 'POST',
          url: '/feedback/send/email/',
          data: formdata,
          success: function(data) { alert("{% trans 'Your message has been sent!' %}") }
         });

        dialog.dialog("close");
      }
        return valid;
      };

      dialog = $('#feedbackform').dialog({
      autoOpen: false,
      modal: true,
      width: 650,
      height: 470,
      draggable: false,
      resizable: false,
      buttons: {
        "{% trans 'Submit' %}": SendFeedbackForm,
        Cancel: function() {
            dialog.dialog("close");
          }
        },
        close: function() {
            form[0].reset();
            allFields.removeClass("ui-state-error");
            updateTips("{% trans 'All form fields are required.' %}");
          }
      });

    form = dialog.find("form").on("submit", function(event) {
      event.preventDefault();
      SendFeedbackForm();
      });

      $('#feebackform-btn').click(function(e) {
      e.preventDefault();
      $('#feedbackform').dialog('open');
      });

    form.on("keypress", "input[type=text]", function(e) {
      if(e.keyCode == 13) {
          SendFeedbackForm();
        }
      });

  });
</script>

<style>

.my-feedback {background:#f7f7f7;}
.my-feedback > label {display:block;font-size:15px;padding:5px 3px 0 3px;margin:5px 3px 0 3px;}
.my-feedback > input {width:600px;border:1px solid #dedede;padding:3px;margin:3px;}
.my-feedback > textarea {width:600px;height:110px;resize:none;border:1px solid #dedede;padding:3px;margin:3px;}
#validateTips {color:#cd0a0a;}
#cpn-tabs-about img, .content-goods-tab img {width:625px;height:auto;}

</style>

    <!-- script for Company-Structure right buttons menu -->
    <script type="text/javascript">
        LANG['structure'] = {
            'confirm': '{% trans "Do you want to delete this record?" %}',
            'popup_ok': '{% trans "OK" %}',
            'popup_cancel': '{% trans "Cancel" %}',
            'popup_dep': '{% trans "Department name" %}',
            'popup_vac': '{% trans "Vacancy title" %}',
            'popup_vac_title': '{% trans "Add the vacancy" %}',
            'popup_loading': '{% trans "Loading..." %}',
        };

        LANG['staff'] = {
            'confirm': '{% trans "Do you want to delete this record?" %}',
            'popup_add': '{% trans "OK" %}',
            'popup_cancel': '{% trans "Cancel" %}',
            'popup_dep': '{% trans "Department name" %}',
            'popup_vac': '{% trans "Vacancy title" %}',
            'popup_administrator': '{% trans "Administrator" %}',
            'popup_title': '{% trans "Add staff" %}',
            'popup_user_title': '{% trans "Add user email" %}',
            'popup_title_edit': '{% trans "Edit staff" %}',
            'popup_loading': '{% trans "Loading..." %}',
            'select_department': '{% trans "Select department" %}',
            'select_vacancy': '{% trans "Select vacancy" %}',
            'popup_hidden_user': '{% trans "Do not show user" %}',
            'extra_permissions_title': '{% trans "Select additional permissions" %}',
            'popup_staffgroup': '{% trans "Related to staff group" %}',
            'popup_for_children': '{% trans "Use permissions for child companies" %}',
        };

        var STAFFGROUPS = [
            {% for item in staffgroups %}
              {"value": {{ item.0 }}, "name": "{{ item.1 }}"},
            {% endfor %}
        ];
        var EXTRAGROUPS = [
            {% for item in extragroups %}
              {"value": {{ item.0 }}, "name": "{{ item.1 }}"},
            {% endfor %}
        ];
    </script>
    <script type="text/javascript">
        $(function(){
            function addOneMoreInput() {
                $('.file-attachment').last().change(function() {
                    $(this).after('<input name="attachment" class="file-attachment" type="file" />');
                    $(this).off('change');
                    addOneMoreInput();
                });
            }
            addOneMoreInput();
        });
    </script>

{% endblock %}

{% block keywords %}{% endblock %}

{% block content %}
    {{ item|register_event:"click"|process_event:request }}
    <div class="company">
      <div class="deal-details">
        <h5 class="article-header">
          {% if item.flag %}
              <div class="company-flag pull-left sprite-flags {{ item.flag }}"></div>
              <!-- <img src="{{ item.flag_url }}" class="flag" title="{{ item.name }}" alt="{{ item.name }}" /> -->
          {% elif item.country.flag %}
              <div class="company-flag pull-left sprite-flags {{ item.country.flag }}"></div>
          {% endif %}
          {{ item.name }}
        </h5>
        {% if item.logo %}
          <img src="{{ item.logo.big }}" class="thumb-deal pull-left" alt="{{ item.logo }}" title="{{ item.logo }}" />
        {% else %}
          <img src="{% static "b24online/img/company.jpg" %}" class="thumb-deal pull-left" alt="" />
        {% endif %}

        {% comment %} Pay membership button {% endcomment %}

        {% if SHOW_PAYMENT_BUTTON %}
          <div class="payjoin">
            {% if DAYS_BEFORE_END == 0 %}
              <span>{% trans "Free period is expired." %}</span>
            {% else %}
              <span>{% trans "Free period will expire in " %}{{ DAYS_BEFORE_END }}{% trans " days." %}</span>
            {% endif %}
            <!-- Script for PayPal payment button -->
            <!-- <a href="#" class="btnpay" id="paypal-membership">{% trans "Pay membership" %}</a> -->
            <div id="paypal-membership" style="padding-left: 30px; padding-bottom: 10px">
              <!-- <script src="https://www.paypalobjects.com/js/external/paypal-button.min.js?merchant=migirov@gmail.com"></script>
              <script src="https://www.paypalobjects.com/js/external/paypal-button.min.js?merchant=slomberg@ymail.com"></script>
              <script src="https://www.paypalobjects.com/js/external/paypal-button.min.js?merchant=afend-developer@tppcenter.com">
                  data-name="{% trans '1-year www.b24online.com membership' %}"
                  data-number="Company ID: {{ item.pk }} ({{ item.title }})"
                  data-quantity="1"
                  data-button="paynow"
                  data-amount="100"
                  data-currency="USD"
                  data-callback="www.b24online.com/payments/membership/"
                  data-env=""
                  data-charset="utf-8"
              ></script> -->

              <!-- PayPal Debugging Info
              Sandbox ApplID: APP-80W284485P519543T
              Sandbox Username: afend-developer_api1.tppcenter.com
              Sandbox Password: 1401112459
              Sandbox Signature: AFcWxV21C7fd0v3bYYYRCpSSRl31AC4CvkAkiTi9Z2vEGtM41XjTq2OI
              Sandbox Endpoint: https://svcs.sandbox.paypal.com/AdaptivePayments/Pay
              Production Endpoint: https://api-3t.paypal.com/nvp -->
            </div>
          </div>
        {% endif %}
        <!-- Pay membership button -->
        {% if item.short_description %}
          <p class="description pull-left">{{ item.short_description|cleanHtml|safe }}</p>
        {% else %}
          <p class="description pull-left">{{ item.description|cleanHtml|safe }}</p>
        {% endif %}

        {% if item.parent %}
          <p class="member-of">
            <b>{% trans 'Member of' %}</b>
            <a href="{{ item.parent.get_absolute_url }}">{{ item.parent.name }}</a>
          </p>
        {% endif %}

        {% b2b_social_buttons item.logo item.name item.description item.pk %}
      </div>

      <div class="row coupon">
        <div class="col-xs-12">
          <div class="col-xs-12 tabs">
            <div id="exTab">
              <ul class="nav nav-tabs tabs-up">
                <li class="active">
                    <a href="#about" data-target="#about" class="media_node active span" data-toggle="tab">
                        {% trans "About" %}
                    </a>
                </li>
                <li>
                    <a href="#recvisits" data-target="#recvisits" data-toggle="tab">
                        {% trans "Recvisits" %}
                    </a>
                </li>
                <li>
                    <a href="{% url "companies:tab_news" item.pk %}" data-target="#news" data-toggle="tabajax">
                        {% trans "News" %}
                    </a>
                </li>
                <li>
                  <a href="{% url "companies:tabs_gallery" item.pk %}" data-target="#gallery" data-toggle="tabajax">
                    {% trans 'Gallery' %}
                  </a>
                </li>
                <li>
                    <a href="{% url "companies:tab_video" item.pk %}" data-target="#video" data-toggle="tabajax">
                        {% trans "Video gallery" %}
                    </a>
                </li>
                <li>
                  <a href="{% url "companies:tabs_documents" item.pk %}" data-target="#documents" data-toggle="tabajax">
                    {% trans 'Documents' %}
                  </a>
                </li>
                <li>
                    <a href="{% url "companies:tab_tenders" item.pk %}" data-target="#tenders" data-toggle="tabajax">
                        {% trans "Tenders" %}
                    </a>
                </li>
                <li>
                    <a href="{% url "companies:tab_exhibitions" item.pk %}" data-target="#exhibitions" data-toggle="tabajax">
                        {% trans "Exhibitions" %}
                    </a>
                </li>
                 <li>
                    <a href="{% url "companies:tab_b2b_products" item.pk %}" data-target="#news-b2b" data-toggle="tabajax">
                        {% trans "B2B Products" %}
                    </a>
                </li>
                 <li>
                    <a href="{% url "companies:tab_b2c_products" item.pk %}" data-target="#news-b2c" data-toggle="tabajax">
                        {% trans "B2C Products" %}
                    </a>
                </li>
                <li>
                    <a href="{% url "companies:tab_innov" item.pk %}" data-target="#innov" data-toggle="tabajax">
                        {% trans 'Innovation Projects' %}
                    </a>
                </li>
                <li>
                    <a href="{% url "companies:tab_proposal" item.pk %}" data-target="#proposal" data-toggle="tabajax">
                        {% trans 'Business Proposals'  %}
                    </a>
                </li>
                <li>
                    <a href="{% url "companies:tab_structure" item.pk %}" data-target="#structure" data-toggle="tabajax">
                        {% trans "Structure" %}
                    </a>
                </li>
                <li>
                    <a href="{% url "companies:tab_staff" item.pk %}" data-target="#staff" data-toggle="tabajax">
                        {% trans "Staff" %}
                    </a>
                </li>
                <li>
                  <a href="#contacts" data-target="#contacts" data-toggle="tab">
                    {% trans "Contacts" %}
                  </a>
                </li>
                <script>
                  $('[data-toggle="tabajax"]').click(function(e) {
                    e.preventDefault()
                    var $this = $(this),
                    loadurl = $this.attr('href'),
                    targ = $this.attr('data-target');

                    $.get(loadurl, function(data) {
                      $(targ).html(data);
                    });

                    $this.tab('show');
                    return false;
                  });
                </script>
              </ul>

              <div class="tab-content">
                <div class="tab-pane active" id="about">
                  <div class="text">{{ item.description|cleanHtml|safe }}</div>
                </div>
                <div class="tab-pane" id="recvisits">recvisits</div>
                <div class="tab-pane" id="news"></div>
                <div class="tab-pane" id="gallery"></div>
                <div class="tab-pane" id="video"></div>
                <div class="tab-pane" id="documents"></div>
                <div class="tab-pane" id="tenders"></div>
                <div class="tab-pane" id="exhibitions"></div>
                <div class="tab-pane" id="news-b2b"></div>
                <div class="tab-pane" id="news-b2c"></div>
                <div class="tab-pane" id="innov"></div>
                <div class="tab-pane" id="proposal"></div>
                <div class="tab-pane" id="structure"></div>
                <div class="tab-pane" id="staff"></div>
                <div class="tab-pane" id="contacts">
                  <div class="contacts">
                    {% if item.address %}
                      <div class="col-xs-12">
                        <div class="col-xs-4 field">Address:</div>
                        <div class="col-xs-8 value">Barakfakih Org. San. Bölg. Ankara Cd. No:30 Kestel / BURSA / TÜRKİYE</div>
                      </div>
                    {% endif %}
                    {% if item.phone %}
                      <div class="col-xs-12">
                        <div class="col-xs-4 field">Telephone number:</div>
                        <div class="col-xs-8 value">90 (224) 411 0680; 90 549 411 06 83</div>
                      </div>
                    {% endif %}
                    {% if item.fax %}
                      <div class="col-xs-12">
                        <div class="col-xs-4 field">Fax:</div>
                        <div class="col-xs-8 value">90 (224) 411 0684</div>
                      </div>
                    {% endif %}
                    {% if item.email %}
                      <div class="col-xs-12">
                        <div class="col-xs-4 field">Email:</div>
                        <div class="col-xs-8 value">sabriye@5mautomotive.com.tr</div>
                      </div>
                    {% endif %}
                    {% if item.site %}
                      <div class="col-xs-12">
                        <div class="col-xs-4 field">WWW:</div>
                        <div class="col-xs-8 value">http://www.5mautomotive.com.tr</div>
                      </div>
                    {% endif %}
                    <div class="col-xs-12">
                      <div class="col-xs-4 field">{% trans 'Feedback' %}:</div>
                      <div class="col-xs-8 value"><a id="feebackform-btn" href="#" data-toggle="modal" data-target="#myModal">{% trans 'Write a message' %}</a></div>
                      <div class="alert alert-success" id="success-alert" style="margin: 30px 10px;">
                        <div>{% trans "Благодарим за Ваш отзыв" %}</div>
                      </div>
                    </div>
                    <div class="org-map" style="height: 100px; width: 100px;">
                      <div id="map-canvas"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(function() {
        $('#save').click(function() {
          var formValid = true;
          $('input').each(function() {
            var formGroup = $(this).parents('.form-group');
            var glyphicon = formGroup.find('.form-control-feedback');
            if (this.checkValidity()) {
              formGroup.addClass('has-success').removeClass('has-error');
              glyphicon.addClass('glyphicon-ok').removeClass('glyphicon-remove');
            } else {
              formGroup.addClass('has-error').removeClass('has-success');
              glyphicon.addClass('glyphicon-remove').removeClass('glyphicon-ok');
              formValid = false;
            }
          });
          $('textarea').each(function() {
            var formGroup = $(this).parents('.form-group');
            var glyphicon = formGroup.find('.form-control-feedback');
            if (this.checkValidity()) {
              formGroup.addClass('has-success').removeClass('has-error');
              glyphicon.addClass('glyphicon-ok').removeClass('glyphicon-remove');
            } else {
              formGroup.addClass('has-error').removeClass('has-success');
              glyphicon.addClass('glyphicon-remove').removeClass('glyphicon-ok');
              formValid = false;
            }
          });
          if (formValid) {
            let formdata = $('#myBootstrapForm').serialize();
             $.ajax({
              type: 'POST',
              url: '/feedback/send/email/',
              data: formdata,
              success: function(data) {
                $('#myModal').modal('hide');
                $("#success-alert").fadeTo(2000, 500).slideUp(500, function() {
                  $("#success-alert").slideUp(500);
                });
              }
             });
           }
        });
      });
      $("#success-alert").ready(function() { $("#success-alert").hide() })
    </script>

    <div class="modal fade" id="myModal" tabindex="-1" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h4 class="modal-title" id="myModalLabel">{% trans "Отправить отзыв" %}</h4>
          </div>
          <div class="modal-body">
        <form action="" id="myBootstrapForm" role="form" class="form-horizontal" method="post">{% csrf_token %}
        <input type="hidden" name="co_email" value="{{ item.email }}">
        <input type="hidden" name="co_id" value="{{ item.pk }}">
        <input type="hidden" name="url_path" value="{{ request.build_absolute_uri }}">
        <div class="form-group has-feedback">
          <label for="login" class="control-label col-xs-3">{% trans "Ваше имя" %}</label>
          <div class="col-xs-8">
            <div class="input-group">
              <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
              <input type="text" class="form-control clear" name="realname" maxlength="40" pattern=".{3,}" title="3 characters minimum" required>
            </div>
            <span class="glyphicon form-control-feedback"></span>
          </div>
        </div>
        <div class="form-group has-feedback">
          <label for="email" class="control-label col-xs-3">{% trans "Ваша почта" %}</label>
          <div class="col-xs-8">
            <div class="input-group">
              <span class="input-group-addon"><i class="glyphicon glyphicon-envelope"></i></span>
              <input type="email" class="form-control clear" maxlength="80" name="email" required>
            </div>
            <span class="glyphicon form-control-feedback"></span>
          </div>
        </div>
        <div class="form-group has-feedback">
          <label for="phone" class="control-label col-xs-3">{% trans "Ваш телефон" %}</label>
          <div class="col-xs-8">
            <div class="input-group">
              <span class="input-group-addon"><i class="glyphicon glyphicon-earphone"></i></span>
              <input type="phone" class="form-control clear" maxlength="40" name="phone" required>
            </div>
            <span class="glyphicon form-control-feedback"></span>
          </div>
        </div>
        <div class="form-group has-feedback">
          <label for="message" class="control-label col-xs-3" maxlength="1000">{% trans "Ваше сообщение" %}</label>
          <div class="col-xs-8">
            <div class="input-group">
              <textarea class="form-control"
                        name="message"
                        id="message"
                        rows="6"
                        style="width: 370px;"
                        maxlength="1000"
                        required
              ></textarea>
            </div>
            <span class="glyphicon form-control-feedback"></span>
          </div>
        </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Отмена" %}</button>
            <button id="save" type="button" class="btn btn-primary">{% trans "Отправить" %}</button>
          </div>
        </div>
      </div>
    </div>

  <div class="cpn-details-tab" id="tpp-details-tab">
    <div class="tab-cate">

    <ul>
      {% for page in item.additional_pages.all %}
           <li><a href="#tabs-{{ forloop.counter0|add:5 }}">{{ page.title|truncatechars:40 }}</a></li>
      {% endfor %}
   </ul>

  </div>

      {% for page in item.additional_pages.all %}
        <div id="tabs-{{ forloop.counter0|add:5 }}">
                <div class="content-goods-tab">{{ page.content|cleanHtml|safe }}</div>
        </div>
      {% endfor %}
  </div>

{% endblock %}
