{% extends 'main_page.html' %}
{% load static %}
{% load i18n %}
{% load CustomFilters %}
{% load inclusionTags %}


    {% block styles %}
         {{ block.super }}
            <link type="text/css" rel="stylesheet" href="{% static 'tppcenter/css/news.css' %}" />
            <link type="text/css" rel="stylesheet" href="{% static 'tppcenter/css/company.css' %}" />
            <link type="text/css" rel="stylesheet" href="{% static 'tppcenter/css/tpp.reset.css' %}" />
            <link type="text/css" rel="stylesheet" href="{% static "tppcenter/css/gmapCompany.css" %}" />

    {% endblock %}
{% block js %}
    {{ block.super }}
    <script>
        {% getOwner item.pk as owner %}


        ga('set', 'dimension1', {{ item.pk }});

        {% if owner %}
            ga('set', 'dimension3', {{ owner.pk }});
        {% endif %}

        ga('set', 'dimension2', 'company');
    </script>


    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
    <script src="{% static "tppcenter/js/gmapSearchMarker.js" %}"></script>
    <script src="{% static "tppcenter/js/jquery.uploadify.min.js" %}"></script>

    <!-- Google maps -->
    <script type="text/javascript">
        var marker;

        $(document).ready(function($) {
                var tabs = $( '#tpp-details-tab' )
                tabs.tabs();
                var href = tabs.find('a[href="#cpn-tabs-contacts"]');
                (href).on('click',function(){

                    {% if item.position %}
                      marker = new google.maps.Marker({
                        position: new google.maps.LatLng({{ item.position }})
                    });
                    {% endif %}

                 initialize(false);

        })});
    </script>
    <!-- /Google maps -->

    <!-- script for Company-Structure right buttons menu -->
    <script type="text/javascript">
        $(function(){
            $(document).on('click', ".sitemap li a", function(){
                if ($(this).parent().find(".sub").is(":hidden")){
                    $(this).parent().find(".sub").show();
                    $(this).addClass('lesssitemap')
                }
                else{
                    $(this).parent().find(".sub").hide();
                    $(this).removeClass('lesssitemap')
                }
                return false;
            });
        });
    </script>



<!-- script for Staff add popup and delete -->
<script type="text/javascript">
    $(function() {
	    $(document).on('click','.btnremove-small', function() {
            var tr = $(this).parents('tr');
            var cabinetID = tr.data('cabinet');
            tr.css("background-color","#FF3700");

            if (confirm('{%  trans "Do you want to delete this record?" %}')) {
                var contentHolder = $('#staff-tab .tpp-dt-content');
                contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');

                $.post("{% url "companies:tab_staff" item.pk %}", {cabinetID: cabinetID}, function(data){
                        contentHolder.replaceWith(data);
                        }, 'html');
            } else {
                 tr.css("background-color", "");
            }

            return false;
		});
        <!-- add Staff (popup window) -->
        $(document).on('click','#user-add-button', function() {
            $('#fade-profile').show();
            $('#popup-context').load("{% url "companies:tab_staff" item.pk %} .staffaddin");
            $('#add-user-popup').show();

            return false;
		});
    });
</script>

<script type="text/javascript">
    $(function(){
        // Staff adding from popup
	    $(document).on('click','#btn-add-user', function(){
            var userEmail = $('#user-name').val();
            var departmentName = $('#dep-list').find(":selected").val();
            var vacancyName = $('#vacancy-list').find(":selected").val();
            var isAdmin = 0;

            if ($('#is-admin').is(':checked')) {
                isAdmin = 1;
            }
            else {
                isAdmin = 0;
            }

            var contentHolder = $('#staff-tab .tpp-dt-content');
            contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');

            $.post("{% url "companies:tab_staff" item.pk %}",
                    {departmentName: departmentName, userEmail: userEmail, vacancyName: vacancyName, isAdmin: isAdmin},
                    function(data){
                        contentHolder.replaceWith(data);
                    }, 'html');

            $('#dep-list:eq(0)').attr('selected','selected');
            $('#fade-profile').hide();

            return false;
		});
	});
</script>

<!-- script for Departments and Vacancies selection -->
<script type="text/javascript">
    $(function() {
        bkgr_color  = 0;
        font_color = 0;
        bg_vac_color = 0;
        vac_font_color = 0;
        departmentID = 0;
        vacancyID = 0;
        currentDepRow = -1;
        currentVacRow = -1;
        bg_color_lookup = '#E6E6E6';
        bg_color_dep_selected = '#B9C9FA';
        text_color_dep_selected = '#FFFFFF';
        bg_color_vac_lookup = '#BBBEBE';
        text_color_vac_lookup = '#FFFFFF';
        bg_color_vac_selected = '#454ED6';
        text_color_vac_selected = '#FFFFFF';

        // lookup Department row
        $(document).on('mouseenter','.sitemap > li', function() {
            currentDepRow = $(this);
            currentDepRow.css('cursor', 'pointer');
            if(departmentID == 0) {
                bkgr_color = currentDepRow.css("background-color");
                font_color = currentDepRow.children('a').css("color");
                currentDepRow.css("background-color", bg_color_lookup);
            }
            else {
                if(currentDepRow.data('department') != departmentID) {
                    bkgr_color = currentDepRow.css("background-color");
                    font_color = currentDepRow.children('a').css("color");
                    currentDepRow.css("background-color", bg_color_lookup);
                }
            }
        });

        // lookup Vacancy row
        $(document).on('mouseenter','.sub > li', function() {
            currentVacRow = $(this);
            currentVacRow.css('cursor', 'pointer');
            if(vacancyID == 0) {
                bg_vac_color = currentVacRow.css("background-color");
                vac_font_color = currentVacRow.css("color");
                currentVacRow.css("background-color", bg_color_vac_lookup);
                currentVacRow.css("color", text_color_vac_lookup);
            }
            else { //if Vacancy already selected...
                //... then lookup only for unselected items
                if(currentVacRow.data('vacancy') != vacancyID) {
                    bg_vac_color = currentVacRow.css("background-color");
                    vac_font_color = currentVacRow.css("color");
                    currentVacRow.css("background-color", bg_color_vac_lookup);
                    currentVacRow.css("color", text_color_vac_lookup);
                }
            }
        });

        // leave Department row
        $(document).on('mouseleave', '.sitemap > li', function() {
            currentDepRow = $(this);
            if(departmentID == 0) {
                currentDepRow.css("background-color", bkgr_color);
                currentDepRow.children('a').css("color", font_color);
            }
            else {
                if(currentDepRow.data('department') != departmentID) {
                    currentDepRow.css("background-color", bkgr_color);
                    currentDepRow.children('a').css("color", font_color);
                }
            }
		});

        // leave Vacancy row
        $(document).on('mouseleave', '.sub > li', function() {
            currentVacRow = $(this);
            if(vacancyID == 0) {
                currentVacRow.css("background-color", bg_vac_color);
                currentVacRow.css("color", vac_font_color);
            }
            else {// if Vacancy already selected then...
                // do not lookup selected Vacancy row
                if(currentVacRow.data('vacancy') != vacancyID) {
                    currentVacRow.css("background-color", bg_vac_color);
                    currentVacRow.css("color", vac_font_color);
                }
            }
		});

        // mark Department row in Company-structure
        $(document).on('click', '.sitemap > li', function() {
		    currentDepRow = $(this);
            currentDepID = currentDepRow.data('department');

            if(departmentID == 0) {
                currentDepRow.css("background-color", bg_color_dep_selected);
                currentDepRow.children('a').css("color", text_color_dep_selected);
                departmentID = currentDepID;
            }
            else {
                var lastSelectedVac = null;
                if(currentDepID == departmentID) {
                    currentDepRow.css("background-color", bkgr_color);
                    currentDepRow.children('a').css("color", font_color);
                    //if deselect Department item with selected Vacancy...
                    if(vacancyID != 0) {
                        lastSelectedVac = $('.sub li[data-vacancy=' + vacancyID + ']');
                        lastSelectedVac.css("background-color", bkgr_color);
                        lastSelectedVac.css("color", vac_font_color);
                        vacancyID = 0;
                    }
                    departmentID = 0;
                    $('#edit-button').css('visibility', 'hidden');
                    $('#remove-button').css('visibility', 'hidden');
                    return false;
                }
                else {
                    currentDepRow.css("background-color", bg_color_dep_selected);
                    currentDepRow.children('a').css("color", text_color_dep_selected);

                    var lastSelectedDep = currentDepRow.parent('ul').find("[data-department='" + departmentID + "']");
                    lastSelectedDep.css("background-color", bkgr_color);
                    lastSelectedDep.children('a').css("color", font_color);
                    departmentID = currentDepID;

                    VacID = memVac == 0 ? vacancyID : memVac;
                    lastSelectedVac = $('.sub li[data-vacancy=' + VacID + ']');
                    lastSelectedVac.css("background-color", bkgr_color);
                    lastSelectedVac.css("color", vac_font_color);
                    vacancyID = 0;
                }
            }
            $('#edit-button').css('visibility', 'visible');
            $('#remove-button').css('visibility', 'visible');
		});

        // mark Vacancy row in Company-structure
        $(document).on('click', '.sub > li', function() {
		    currentVacRow = $(this);
            var currentVacID = currentVacRow.data('vacancy');
            var currentDepID = currentVacRow.data('department');

            if(vacancyID == 0) {
                currentVacRow.css("background-color", bg_color_vac_selected);
                currentVacRow.css("color", text_color_vac_selected);
                memVac = vacancyID;
                vacancyID = currentVacID;
                if(departmentID != 0) {
                    return false;
                }
            }
            else {
                // if it's the same row
                if(currentVacID == vacancyID) {
                    currentVacRow.css("background-color", bg_color_vac_lookup);
                    currentVacRow.css("color", text_color_vac_lookup);
                    vacancyID = 0;
                    return false;
                }
                else {
                    //mark current row...
                    currentVacRow.css("background-color", bg_color_vac_selected);
                    currentVacRow.css("color", text_color_vac_selected);
                    // ...clear previous row
                    var lastSelectedVacRow = currentVacRow.parent('ul').find("[data-vacancy='" + vacancyID + "']");
                    lastSelectedVacRow.css("background-color", bkgr_color);
                    lastSelectedVacRow.css("color", vac_font_color);
                    memVac = vacancyID; // save vacancy id for event on the higher level
                    vacancyID = currentVacID;
                    // if previous row in the same department we don't promote event to it
                    if(currentDepID == departmentID) {
                        return false;
                    }
                }
            }
		});

        //============== Operation menu ====================================
        // add Department (popup window)
        $(document).on('click','#add-button', function() {
            if(departmentID == 0) {
                $('#fade-profile').show();
                $('.staffadd').show();
                return false;
            }
            else {
                $('#fade-profile').show();
                $('.vacadd').show();
                return false;
            }
		});

        // edit Department or Vacancy (popup window)
        $(document).on('click','#edit-button', function() {
            if(departmentID != 0 && vacancyID == 0) {
                prevDepName = currentDepRow.context.innerText;
                $('#dep-name').val(prevDepName);
                $('#fade-profile').show();
                $('.staffadd').show();
                return false;
            }
            else {
                if(vacancyID != 0) {
                    prevVacName = currentVacRow.context.innerText;
                    $('#vac-name').val(prevVacName);
                    $('#fade-profile').show();
                    $('.vacadd').show();
                    return false;
                }
            }
		});

        // remove Department or Vacancy
        $(document).on('click','#remove-button', function() {
            var contentHolder = $('#structure-tab .tpp-dt-content');
            if(vacancyID != 0) {
                if(confirm('{% trans "Do you want to delete this Vacancy?" %}')) {
                    contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');
                    $.post('{% url "companies:tab_structure" item.pk %}', {vacancyID: vacancyID}, function(data){
                                contentHolder.replaceWith(data);
                            }, 'html');
                }
                vacancyID = 0;
                return false;
            }
            else {
                if(departmentID !=0) {
                    if(confirm('{% trans "Do you want to delete this Department?" %}')) {
                        contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');
                        $.post('{% url "companies:tab_structure" item.pk %}', {departmentDelID: departmentID}, function(data){
                                    contentHolder.replaceWith(data);
                                }, 'html');
                    }
                    departmentID = 0;
                    return false;
                }
            }
		});
	});
</script>

<!-- ===================== Company Structure popups ======================================= -->
<script type="text/javascript">
    // script for Department popup window
    prevDepName = '';
    $(function(){
        // press Add button
	    $(document).on('click','#btn-add-depart', function() {
            var inputField = $('#dep-name');
            var departmentName = inputField.val();
            var contentHolder = $('#structure-tab .tpp-dt-content');

            contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');

            $.post("{% url "companies:tab_structure" item.pk %}",
                    {departmentName: departmentName, prevDepName: prevDepName},
                    function(data){
                        contentHolder.replaceWith(data);
                    }, 'html');

            inputField.empty();
            prevDepName = '';
            $('.staffadd').hide();      <!-- hide pop-up window -->
            $('#fade-profile').hide();  <!-- switch off gray background -->
            return false;
		});
        <!-- press Cancel button -->
	    $(document).on('click','.btntype1', function()
        {
            $('.staffadd').hide();      <!-- hide pop-up window -->
            $('#fade-profile').hide();  <!-- switch off gray background -->
            return false;
		});
	});
</script>

<script type="text/javascript">
    // script for Vacancy popup window
    prevVacName = '';
    $(function(){
        // press Add button
	    $(document).on('click','#btn-add-vacancy', function() {
            var inputField = $('#vac-name');
            var vacancyName = inputField.val();
            var contentHolder = $('#structure-tab .tpp-dt-content');

            contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');

            $.post("{% url "companies:tab_structure" item.pk %}",
                    {vacancyName: vacancyName, departmentID: departmentID, prevVacName: prevVacName},
                    function(data){
                        contentHolder.replaceWith(data);
                    }, 'html');

            inputField.empty();
            prevVacName = '';
            $('.vacadd').hide();      <!-- hide pop-up window -->
            $('#fade-profile').hide();  <!-- switch off gray background -->
            return false;
		});

        // press Cancel button
	    $(document).on('click','.btntype1', function() {
            $('.vacadd').hide();      <!-- hide pop-up window -->
            $('#fade-profile').hide();  <!-- switch off gray background -->
            return false;
		});
	});
</script>
{% endblock %}

{% block keywords %}{% endblock %}

{% block content %}
    <div class="companies">
        <div class="deal-details">
            <h3> <i class="flag sprite {{ item.country.flag }}"></i>
                     {{ item.title }}
                    </h3>
                    {% if image %}
                        <img src="{{ MEDIA_URL }}big/{{ item.image }}" class="thumb-deal" alt="{{ item.title }}" title="{{ item.title }}" />
                    {% else %}
                        <img src="{% static "tppcenter/img/company.jpg" %}" class="thumb-deal" alt="" />
                    {% endif %}
                    {% comment %} Pay membership button {% endcomment %}
                    {% if SHOW_PAYMENT_BUTTON %}
                        <div class="payjoin">
                            {% if DAYS_BEFORE_END == 0 %}
                                <span>{% trans "Free period is expired." %}</span>
                            {% else %}
                                <span>{% trans "Free period will expire in " %}{{ DAYS_BEFORE_END }}{% trans " days." %}</span>
                            {% endif %}
                            <!-- Script for PayPal payment button -->
                            {% comment %}<a href="#" class="btnpay" id="paypal-membership">{% trans "Pay membership" %}</a>{% endcomment %}
                            <div id="paypal-membership" style="padding-left: 30px; padding-bottom: 10px">
                                <script src="https://www.paypalobjects.com/js/external/paypal-button.min.js?merchant=migirov@gmail.com"
                                {% comment %}<script src="https://www.paypalobjects.com/js/external/paypal-button.min.js?merchant=slomberg@ymail.com"{% endcomment %}
                                {% comment %}<script src="https://www.paypalobjects.com/js/external/paypal-button.min.js?merchant=afend-developer@tppcenter.com"{% endcomment %}
                                    data-name="{% trans '1-year www.b24online.com membership' %}"
                                    data-number="Company ID: {{ item.pk }} ({{ item.title }})" {% comment %} Company's database ID{% endcomment %}
                                    data-quantity="1"
                                    data-button="paynow"
                                    data-amount="100"
                                    data-currency="USD"
                                    data-callback="www.b24online.com/payments/membership/"
                                    {% comment %}data-callback="http://tppcenter.ngrok.com/payments/membership/"{% endcomment %}
                                    data-env=""
                                    data-charset="utf-8" {% comment %}for non-english names passing to PayPal {% endcomment %}
                                ></script>
                                {% comment %}
                                PayPal Debugging Info
                                Sandbox ApplID: APP-80W284485P519543T
                                Sandbox Username: afend-developer_api1.tppcenter.com
                                Sandbox Password: 1401112459
                                Sandbox Signature: AFcWxV21C7fd0v3bYYYRCpSSRl31AC4CvkAkiTi9Z2vEGtM41XjTq2OI
                                Sandbox Endpoint: https://svcs.sandbox.paypal.com/AdaptivePayments/Pay
                                Production Endpoint: https://api-3t.paypal.com/nvp
                                {% endcomment %}
                            </div>
                        </div>
                    {% endif %}
                    {% comment %} /Pay membership button {% endcomment %}
                    {% if item.anons %}
                        <p>{{ item.anons|cleanHtml|safe }}</p>
                    {% else %}
                        <p>{{ item.text|cleanHtml|safe }}</p>
                    {% endif %}
                {% if item.organization.title %}
                     <p><b>{% trans 'Member of' %}</b> <a href="{% url 'tpp:detail' item.organization.slug %}">{{ item.organization.title }}</a></p>
                {% endif %}
                </div>
                {% b2bSocialButtons  item.image item.title item.text %}

                <div class="cpn-details-tab" id="tpp-details-tab">
                    <div class="tab-cate">
                        <ul>
                        	<li>
                                <a href="#cpn-tabs-about">
                                    {% trans "About" %}
                                </a>
                            </li>
                            {% for page in additionalPages %}
                                 <li><a href="#tabs-{{ forloop.counter0|add:5 }}">{{ page.getTitle|truncatechars:10 }}</a></li>
                            {% endfor %}
                            <li>
                                <a href="#cpn-tabs-recvisits">
                                    {% trans "Recvisits" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="news-tab" href="{% url "companies:tab_news" item.pk %}">
                                    {% trans "News" %}
                                </a>
                            </li>
                           <!--
                            <li>
                                <a href="#cpn-tabs-services">
                                    {% trans "Services" %}
                                </a>
                            </li>
                            -->
                            <li>
                                <a data-id="gallery-tabs" href="{% url "companies:tabs_gallery" item.pk %}">
                                    {% trans "Gallery" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="tenders-tenders" href="{% url "companies:tab_tenders" item.pk %}">
                                    {% trans "Tenders" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="exhibitions-tab" href="{% url "companies:tab_exhibitions" item.pk %}">
                                    {% trans "Exhibitions" %}
                                </a>
                            </li>
                             <li>
                                <a data-id="news-tab" href="{% url "companies:tab_products" item.pk %}">
                                    {% trans "Products" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="innov-tab" href="{% url "companies:tab_innov" item.pk %}">
                                    {% trans 'Innovation Projects' %}
                                </a>
                            </li>
                            <li>
                                <a data-id="proposal-tab" href="{% url "companies:tab_proposal" item.pk %}">
                                    {% trans 'Business Proposals'  %}
                                </a>
                            </li>
                            <li>
                                <a data-id="structure-tab" href="{% url "companies:tab_structure" item.pk %}">
                                    {% trans "Structure" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="staff-tab" href="{% url "companies:tab_staff" item.pk %}">
                                    {% trans "Staff" %}
                                </a>
                            </li>

                            <li>
                                <a href="#cpn-tabs-contacts">
                                    {% trans "Contacts" %}
                                </a>
                            </li>

                        </ul>
                    </div>
                    <div id="cpn-tabs-about">
                        <div class="tpp-dt-content">
                        	{{ item.text|cleanHtml|safe }}
                        </div>
                    </div>
                    {% for page in additionalPages %}
                        <div id="tabs-{{ forloop.counter0|add:5 }}">
                              <div class="content-goods-tab">{{ page.getContent|cleanHtml|safe }}</div>
                         </div>
                    {% endfor %}
                    <div id="cpn-tabs-recvisits">
                        <div class="tpp-dt-content"></div>
                    </div>
                    <!--
                    <div id="cpn-tabs-services">
                        <div class="tpp-dt-content">Финский инженер и хакер Оона Ряйсянен (Oona Räisänen), которая увлекается обработкой звука, случайно обнаружила на Youtube видеозапись, сделанную с вертолёта во время преследования автомобиля. Оону не увлекли приключения полиции, но она очень заинтересовалась необычным звуком, Оону не увлекли приключения полиции, но она очень заинтересовалась необычным звуком</div>
                    </div>
                    -->
            <div id="cpn-tabs-contacts">
                <div class="tpp-dt-content">

                    <div class="org-contacts">
                        <ul class="innov-tab-content">
                            {% if item.address %}
                                <li>
                                    <span class="left">{% trans 'Address' %}: </span>
                                    <span class="right">{{ item.address }}</span>
                                </li>
                            {% endif %}
                            {% if item.phone %}
                                <li>
                                    <span class="left">{% trans 'Telephone number' %}: </span>
                                    <span class="right">{{ item.phone }} </span>
                                </li>
                            {% endif %}
                            {% if item.fax %}
                                <li>
                                    <span class="left">{% trans 'Fax' %}: </span>
                                    <span class="right">{{ item.fax }}</span>
                                </li>
                            {% endif %}
                            {% if item.email %}
                                <li>
                                    	<span class="left">{% trans 'Email' %}: </span>
                                        <span class="right">{{ item.email }}</span>
                                </li>
                            {% endif %}
                            {% if item.site %}
                                <li>
                                    <span class="left">{% trans 'WWW' %}: </span>
                                    <span class="right">{{ item.site }}</span>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                    <div class="org-map"> <div   id="map-canvas"></div></div>

                </div>
            </div>
        </div>
  </div>
{% endblock %}