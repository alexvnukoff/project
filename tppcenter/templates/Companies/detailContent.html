{% load static %}
{% load i18n %}
{% load CustomFilters %}

<script>
    $('.keyword').html('');
</script>
<script>
    {% getOwner item_id as owner %}


    ga('set', 'dimension1', {{ item_id }});

    {% if owner %}
        ga('set', 'dimension3', {{ owner.id }});
    {% endif %}

    ga('set', 'dimension2', 'company');
</script>

{% with companyValues.POSITION.0 as position %}
<link type="text/css" rel="stylesheet" href="{% static "tppcenter/css/gmapCompany.css" %}" />


<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=places"></script>
<script src="{% static "tppcenter/js/gmapSearchMarker.js" %}"></script>
<script src="{% static "tppcenter/js/jquery.uploadify.min.js" %}"></script>


<!-- Gallery uploader -->
<style>
    .uploader {
        max-height: 130px;
        overflow-y: hidden;
    }
    #queue, #file_upload {
        float: left;
        margin-left: 20px;
    }
    .uploader:after {
       content: "";
       display: block;
       clear: both;
    }
</style>
<script>
    LANG['UPLOAD'] = {
        'uploading': '{% trans "Uploading" %}',
        'success': '{% trans "Uploaded" %}',
        'fail': '{% trans "Fail" %}',
        'wasUploaded': '{% trans "The following files was not uploaded" %}'
    };

    var swf = '{% static "tppcenter/uploadify.swf" %}';
    var uploader = '{% url "companies:tabs_gallery" item_id %}';
    var buttonImage= '{% static "tppcenter/img/addimage.jpg" %}';

    $(document).ready(function($) {

       //galleryUpload.init(LANG['UPLOAD'], swf, buttonImage , uploader);
    });
</script>
<!-- /Gallery uploader -->

<!-- Google maps -->
<script type="text/javascript">
    var marker;

    $(document).ready(function($) {
            var tabs = $( '#tpp-details-tab' )
            tabs.tabs();
            var href = tabs.find('a[href="#cpn-tabs-contacts"]');
            (href).on('click',function(){

                {% if position %}
                  marker = new google.maps.Marker({
                    position: new google.maps.LatLng({{ position }})
                });
                {% endif %}

             initialize(false);

    })});
</script>
<!-- /Google maps -->

<!-- script for Company-details-structure right buttons menu -->
<script type="text/javascript">
    $(function(){
	    $(document).on('click', ".sitemap li a", function(){
		    if ($(this).parent().find(".sub").is(":hidden")){
			    $(this).parent().find(".sub").show();
				$(this).addClass('lesssitemap')
			}
			else{
			    $(this).parent().find(".sub").hide();
				$(this).removeClass('lesssitemap')
			}
            return false;
        });
	});
</script>

<!-- script for Company-details-staff delete content button -->
<script type="text/javascript">
    $(function(){
	    $(document).on('mouseenter','.table-staff tr', function(){

		    $(this).children().find(".btnremove-small").show();
		});

        $(document).on('mouseleave', '.table-staff tr', function(){
		    $(this).children().find(".btnremove-small").hide();
		});
	});
</script>

<!-- script for Staff add popup and delete -->
<script type="text/javascript">
    $(function(){
	    $(document).on('click','.btnremove-small', function(){
            var tr = $(this).parents('tr');
            var cabinetID = tr.data('cabinet');
            var color  = $(this).css("background-color");
            tr.css("background-color","#FF3700");

            if (confirm('Do you want to delete this record?'))
            {
                var contentHolder = $('#staff-tab .tpp-dt-content');
                contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');

                $.post("{% url "companies:tab_staff" item_id %}", {cabinetID: cabinetID}, function(data){
                        contentHolder.replaceWith(data);
                        }, 'html');
            }
            else
            {
                 tr.css("background", color);
            }
            return false;
		});
        <!-- add Staff (popup window) -->
        $(document).on('click','#user-add-button', function(){
            $('#fade-profile').show();
            $('#popup-context').load("{% url "companies:tab_staff" item_id %} .staffaddin");
            $('#add-user-popup').show();

            return false;
		});
    });
</script>

<script type="text/javascript">
    $(function(){
        // Staff adding from popup
	    $(document).on('click','#btn-add-user', function(){

            var userEmail = $('#user-name').val();
            var departmentName = $('#dep-list').find(":selected").text();
            var vacancyName = $('#vacancy-list').find(":selected").text();
            var isAdmin = 0;
            if ($('#is-admin').is(':checked'))
            {
                isAdmin = 1;
            }
            else
            {
                isAdmin = 0;
            }

            var contentHolder = $('#staff-tab .tpp-dt-content');
            contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');

            $.post("{% url "companies:tab_staff" item_id %}",
                    {departmentName: departmentName, userEmail: userEmail, vacancyName: vacancyName, isAdmin: isAdmin},
                    function(data){
                        contentHolder.replaceWith(data);
                        }, 'html');

            $('#dep-list:eq(0)').attr('selected','selected');
            $('#fade-profile').hide();

            return false;
		});
	});
</script>

<!-- script for Department adding (popup window)-->
<script type="text/javascript">
    var prevDepName = '';
    $(function(){
        // press Add button
	    $(document).on('click','#btn-add-depart', function()
        {
            var inputField = $('#dep-name');
            var departmentName = inputField.val();
            var contentHolder = $('#structure-tab .tpp-dt-content');

            contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');

            $.post("{% url "companies:tab_structure" item_id %}",
                    {departmentName: departmentName, prevDepName: prevDepName},
                    function(data){
                        contentHolder.replaceWith(data);
                    }, 'html');

            inputField.empty();
            prevDepName = '';
            $('.staffadd').hide();      <!-- hide pop-up window -->
            $('#fade-profile').hide();  <!-- switch off gray background -->
            return false;
		});
        <!-- press Cancel button -->
	    $(document).on('click','.btntype1', function()
        {
            $('.staffadd').hide();      <!-- hide pop-up window -->
            $('#fade-profile').hide();  <!-- switch off gray background -->
            return false;
		});

	});
</script>

<!-- script for Departments and Vacancies selection -->
<script type="text/javascript">
    $(function(){
        bkgr_color  = 0;
        font_color = 0;
        bg_vac_color = 0;
        vac_font_color = 0;

        departmentID = 0;
        vacancyID = 0;
        currentDepRow = -1;
        currentVacRow = -1;
        bg_color_lookup = '#E6E6E6';
        bg_color_dep_selected = '#B9C9FA';
        text_color_dep_selected = '#FFFFFF';
        bg_color_vac_lookup = '#BBBEBE';
        text_color_vac_lookup = '#FFFFFF';
        bg_color_vac_selected = '#454ED6';
        text_color_vac_selected = '#FFFFFF';

        <!-- lookup Department row -->
        $(document).on('mouseenter','.sitemap > li', function(){
            currentDepRow = $(this);
            currentDepRow.css('cursor', 'pointer');
            if(departmentID == 0)
            {
                bkgr_color = currentDepRow.css("background-color");
                font_color = currentDepRow.children('a').css("color");
                currentDepRow.css("background-color", bg_color_lookup);
            }
            else
            {
                if(currentDepRow.data('department') != departmentID)
                {
                    bkgr_color = currentDepRow.css("background-color");
                    font_color = currentDepRow.children('a').css("color");
                    currentDepRow.css("background-color", bg_color_lookup);
                }
            }
        });
        <!-- lookup Vacancy row -->
        $(document).on('mouseenter','.sub > li', function(){
            currentVacRow = $(this);
            currentVacRow.css('cursor', 'pointer');
            if(vacancyID == 0)
            {
                bg_vac_color = currentVacRow.css("background-color");
                vac_font_color = currentVacRow.css("color");
                currentVacRow.css("background-color", bg_color_vac_lookup);
                currentVacRow.css("color", text_color_vac_lookup);
            }
            else //if Vacancy already selected...
            {
                //... then lookup only for unselected items
                if(currentVacRow.data('vacancy') != vacancyID)
                {
                    bg_vac_color = currentVacRow.css("background-color");
                    vac_font_color = currentVacRow.css("color");
                    currentVacRow.css("background-color", bg_color_vac_lookup);
                    currentVacRow.css("color", text_color_vac_lookup);
                }
            }
        });

        // leave Department row
        $(document).on('mouseleave', '.sitemap > li', function(){
            currentDepRow = $(this);
            if(departmentID == 0)
            {
                currentDepRow.css("background-color", bkgr_color);
                currentDepRow.children('a').css("color", font_color);
            }
            else
            {
                if(currentDepRow.data('department') != departmentID)
                {
                    currentDepRow.css("background-color", bkgr_color);
                    currentDepRow.children('a').css("color", font_color);
                }
            }
		});

        // leave Vacancy row
        $(document).on('mouseleave', '.sub > li', function(){
            currentVacRow = $(this);
            if(vacancyID == 0)
            {
                currentVacRow.css("background-color", bg_vac_color);
                currentVacRow.css("color", vac_font_color);
            }
            else // if Vacancy already selected then...
            {
                // do not lookup selected Vacancy row
                if(currentVacRow.data('vacancy') != vacancyID)
                {
                    currentVacRow.css("background-color", bg_vac_color);
                    currentVacRow.css("color", vac_font_color);
                }
            }
		});

        // mark Department row in Company-structure
        $(document).on('click', '.sitemap > li', function(){
		    currentDepRow = $(this);
            currentDepRow.css("background-color", bg_color_dep_selected);
            currentDepRow.children('a').css("color", text_color_dep_selected);
            // deselect previous Department selection if it was
            // get selected Department's ID
            var newSelectedRow = currentDepRow.data('department');
            // if prev selected Department exists and it's an another Department...
            if(departmentID != 0 && departmentID != newSelectedRow)
            {
                var lastSelectedRow = currentDepRow.parent('ul').find("[data-department='" + departmentID + "']");
                lastSelectedRow.css("background-color", bkgr_color);
                lastSelectedRow.children('a').css("color", font_color);
                // clear selected Vacancy
                vacancyID = 0;
                lastSelectedRow.css("color", vac_font_color);
            }
            else
            {
                if(departmentID != 0)
                {
                    // deselect Department on the second click
                    var lastSelectedDepRow = currentDepRow.parent('ul').find("[data-department='" + departmentID + "']");
                    lastSelectedDepRow.css("background-color", bkgr_color);
                    lastSelectedDepRow.children('a').css("color", font_color);
                    $('#dep-remove-button').css('visibility', 'hidden');
                    $('#dep-edit-button').css('visibility', 'hidden');
                    departmentID = 0;
                    vacancyID = 0;
                    return false;
                }
            }

            departmentID = newSelectedRow;
            $('#dep-remove-button').css('visibility', 'visible');
            $('#dep-edit-button').css('visibility', 'visible');
		});

        // mark Vacancy row in Company-structure
        $(document).on('click', '.sub > li', function(){
		    currentVacRow = $(this);
            currentVacRow.css("background-color", bg_color_vac_selected);
            currentVacRow.css("color", text_color_vac_selected);
            // deselect previous vacancy selection if it was
            var newSelectedRow = currentVacRow.data('vacancy');
            if(vacancyID != 0 && vacancyID != newSelectedRow)
            {
                var lastSelectedVacRow = currentVacRow.parent('ul').find("[data-vacancy='" + vacancyID + "']");
                lastSelectedVacRow.css("background-color", bkgr_color);
                lastSelectedVacRow.css("color", vac_font_color);
                //deselect prev Department
                var lastSelectedDepRow = currentVacRow.parent('ul').find("[data-department='" + departmentID + "']");
                lastSelectedDepRow.css("background-color", bkgr_color);
                lastSelectedDepRow.css("color", font_color);
            }
            else
            {
                if(vacancyID != 0)
                {
                    // deselect Vacancy on the second click
                    var lastSelectedVacRow = currentVacRow.parent('ul').find("[data-vacancy='" + vacancyID + "']");
                    lastSelectedVacRow.css("background-color", bg_color_vac_lookup);
                    lastSelectedVacRow.css("color", text_color_vac_lookup);
                    vacancyID = 0;
                    return false;
                }
            }
            vacancyID = newSelectedRow;
		});

        //============== Operation menu ====================================
        // add Department (popup window)
        $(document).on('click','#dep-add-button', function(){
            $('#fade-profile').show();
            $('.staffadd').show();
            return false;
		});

        <!-- edit Department (popup window)-->
        $(document).on('click','#dep-edit-button', function(){
            var selectedRow = currentDepRow.parent('ul').find("[data-department='" + departmentID + "']");
            prevDepName = selectedRow.context.innerText;
            $('#dep-name').val(prevDepName);
            $('#fade-profile').show();
            $('.staffadd').show();
            return false;
		});

        <!-- remove Department -->
        $(document).on('click','#dep-remove-button', function()
        {
            var contentHolder = $('#structure-tab .tpp-dt-content');

            if (confirm('Do you want to delete this Department?'))
            {
                contentHolder.html('<div class="loader"><img class="loader-img" src="' + statciPath + 'img/ajax-loader.gif"/></div>');
                $.post("{% url "companies:tab_structure" item_id %}", {departmentID: departmentID}, function(data){
                            contentHolder.replaceWith(data);
                        }, 'html');
            }
            return false;
		});
	});
</script>

<div class="companies">

            {% with companyValues.NAME.0 as name %}
            {% with companyValues.DETAIL_TEXT.0 as content %}
            {% with companyValues.IMAGE.0 as image %}
            {% with companyValues.ADDRESS.0 as address %}
            {% with companyValues.TELEPHONE_NUMBER.0 as telephone_number %}
            {% with companyValues.EMAIL.0 as email %}
            {% with companyValues.FAX.0 as fax %}
            {% with companyValues.ANONS.0 as anons %}
            {% with companyValues.SITE_NAME.0 as site_name %}

            {% with country.FLAG.0 as country_flag %}
            {% with country.COUNTRY_FLAG.0 as flag_class %}
            {% with country.NAME.0 as country_name %}


                <div class="deal-details">
                    <h3>
                     {% if flag_class %}
                            <i class="sprite {{ flag_class }}"></i>
                            {% else %}
                             <img src="{{ MEDIA_URL }}small/{{ country_flag }}" class="flag" alt="{{ country_name }}" title="{{ country_name }}" />
                     {% endif %}
                     {{ name }}
                    </h3>
                    {% if image %}
                    <img src="{{ MEDIA_URL }}big/{{ image }}" class="thumb-deal" alt="{{ name }}" title="{{ name }}" />
                    {% else %}
                    <img src="{% static "tppcenter/img/company.jpg" %}" class="thumb-deal" alt="" />
                    {% endif %}
                    {% if anons %}
                      <p>{{ anons|cleanHtml|safe }}</p>
                    {% else %}
                      <p>{{ content|cleanHtml|safe }}</p>
                    {% endif %}
                </div>
                <div class="social">
                    <a href="#"><i class="imgnews share-1"></i></a>
                    <a href="#"><i class="imgnews share-2"></i></a>
                    <a href="#"><i class="imgnews share-3"></i></a>
                    <a href="#"><i class="imgnews share-4"></i></a>
                </div>

                <div class="cpn-details-tab" id="tpp-details-tab">
                    <div class="tab-cate">
                        <ul>
                        	<li>
                                <a href="#cpn-tabs-about">
                                    {% trans "About" %}
                                </a>
                            </li>
                            <li>
                                <a href="#cpn-tabs-recvisits">
                                    {% trans "Recvisits" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="news-tab" href="{% url "companies:tab_news" item_id %}">
                                    {% trans "News" %}
                                </a>
                            </li>
                           <!--
                            <li>
                                <a href="#cpn-tabs-services">
                                    {% trans "Services" %}
                                </a>
                            </li>
                            -->
                            <li>
                                <a href="#cpn-tabs-gallery">
                                    {% trans "Gallery" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="tenders-tenders" href="{% url "companies:tab_tenders" item_id %}">
                                    {% trans "Tenders" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="exhibitions-tab" href="{% url "companies:tab_exhibitions" item_id %}">
                                    {% trans "Exhibitions" %}
                                </a>
                            </li>
                             <li>
                                <a data-id="news-tab" href="{% url "companies:tab_products" item_id %}">
                                    {% trans "Products" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="innov-tab" href="{% url "companies:tab_innov" item_id %}">
                                    {% trans 'Innovation Projects' %}
                                </a>
                            </li>
                            <li>
                                <a data-id="proposal-tab" href="{% url "companies:tab_proposal" item_id %}">
                                    {% trans 'Business Proposals'  %}
                                </a>
                            </li>
                            <li>
                                <a data-id="structure-tab" href="{% url "companies:tab_structure" item_id %}">
                                    {% trans "Structure" %}
                                </a>
                            </li>
                            <li>
                                <a data-id="staff-tab" href="{% url "companies:tab_staff" item_id %}">
                                    {% trans "Staff" %}
                                </a>
                            </li>

                            <li>
                                <a href="#cpn-tabs-contacts">
                                    {% trans "Contacts" %}
                                </a>
                            </li>

                        </ul>
                    </div>
                    <div id="cpn-tabs-about">
                        <div class="tpp-dt-content">
                        	{{ content|cleanHtml|safe }}
                        </div>
                    </div>
                    <div id="cpn-tabs-recvisits">
                        <div class="tpp-dt-content"></div>
                    </div>
                    <!--
                    <div id="cpn-tabs-services">
                        <div class="tpp-dt-content">Финский инженер и хакер Оона Ряйсянен (Oona Räisänen), которая увлекается обработкой звука, случайно обнаружила на Youtube видеозапись, сделанную с вертолёта во время преследования автомобиля. Оону не увлекли приключения полиции, но она очень заинтересовалась необычным звуком, Оону не увлекли приключения полиции, но она очень заинтересовалась необычным звуком</div>
                    </div>
                    -->
                    <div id="cpn-tabs-gallery">
                        <div class="tpp-dt-content">
                        <!--
                            <div class="uploader">
                                <form>
                                    <input id="file_upload" name="file_upload" type="file" multiple="true">
                                    <div id="queue"></div>

                                </form>
                            </div>
                            <ul class="tpp-gallery">
                                {% comment %}
                                    {% for photo in photos %}
                                        {% include "Companies/tabGalleryPhoto.html" %}
                                    {% endfor %}
                                {% endcomment %}
                            </ul>
                        -->
                        </div>

                    </div>
                    <div id="cpn-tabs-contacts">
                        <div class="tpp-dt-content">

                             <div class="org-contacts">
                               <ul>
                                	<li>
                                    	<span class="left">{% trans 'Address' %}: </span>
                                        <span class="right">{{ address }}</span>
                                    </li>
                                    <li>
                                    	<span class="left">{% trans 'Telephone number' %}: </span>
                                        <span class="right">{{ telephone_number }} </span>
                                    </li>
                                    <li>
                                    	<span class="left">{% trans 'Fax' %}: </span>
                                        <span class="right">{{ fax }}</span>
                                    </li>
                                    <li>
                                    	<span class="left">{% trans 'Email' %}: </span>
                                        <span class="right">{{ email }}</span>
                                    </li>
                                    <li>
                                    	<span class="left">{% trans 'WWW' %}: </span>
                                        <span class="right">{{ site_name }}</span>
                                    </li>
                                </ul>
                             </div>

                              <div class="org-map"> <div   id="map-canvas"></div></div>

                        </div>
                    </div>
                </div>
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
            {% endwith %}
  </div>

{% endwith %}